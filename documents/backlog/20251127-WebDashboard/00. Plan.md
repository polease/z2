# Implementation Plan - Web Dashboard

## Phase 1: Backend Foundation
- [ ] 1.1 Set up PostgreSQL database
  - [ ] Install PostgreSQL (if not installed)
  - [ ] Create database `z2_platform`
  - [ ] Create database user and grant permissions
- [ ] 1.2 Create database schema
  - [ ] Create `jobs` table
  - [ ] Create `job_metadata` table
  - [ ] Create `job_logs` table
  - [ ] Create `job_files` table
  - [ ] Create `job_analysis` table
  - [ ] Create `job_publishing` table
  - [ ] Create indexes
- [ ] 1.3 Set up FastAPI project structure
  - [ ] Create `src/web/` directory structure
  - [ ] Install dependencies (FastAPI, uvicorn, SQLAlchemy, psycopg2, websockets)
  - [ ] Create `requirements-web.txt`
  - [ ] Create `main.py` with basic FastAPI app
  - [ ] Set up database connection with SQLAlchemy
- [ ] 1.4 Create SQLAlchemy models
  - [ ] Create models for all tables
  - [ ] Create Pydantic schemas for request/response
- [ ] 1.5 Implement basic CRUD operations
  - [ ] Job creation (insert into DB)
  - [ ] Job retrieval (get by ID, list all)
  - [ ] Job update (status, progress)
  - [ ] Job deletion (soft delete/cancel)

## Phase 2: Pipeline Integration
- [ ] 2.1 Create job queue manager
  - [ ] Implement async queue with asyncio.Queue
  - [ ] Implement worker pool (max 2 concurrent jobs)
  - [ ] Add job tracking (active jobs dict)
- [ ] 2.2 Create pipeline runner wrapper
  - [ ] Wrap existing pipeline in async function
  - [ ] Add status updates at each stage
  - [ ] Add progress tracking
  - [ ] Handle cancellation
  - [ ] Handle errors and update DB
- [ ] 2.3 Create database logger
  - [ ] Custom logger that writes to `job_logs` table
  - [ ] Integrate with existing logger
  - [ ] Add log levels (INFO, WARNING, ERROR)
  - [ ] Add stage tracking
- [ ] 2.4 Migrate existing JSON data
  - [ ] Create migration script
  - [ ] Import existing jobs from `storage/data/`
  - [ ] Verify data integrity

## Phase 3: REST API Implementation
- [ ] 3.1 Job submission endpoint
  - [ ] POST /api/jobs
  - [ ] Validate YouTube URL
  - [ ] Create job record in DB
  - [ ] Enqueue job
  - [ ] Return job ID and status
- [ ] 3.2 Job listing endpoint
  - [ ] GET /api/jobs
  - [ ] Add pagination (limit, offset)
  - [ ] Add filtering by status
  - [ ] Add sorting by date
  - [ ] Return job summary list
- [ ] 3.3 Job detail endpoint
  - [ ] GET /api/jobs/{job_id}
  - [ ] Join with metadata, files, analysis, publishing
  - [ ] Return complete job information
- [ ] 3.4 Job cancellation endpoint
  - [ ] DELETE /api/jobs/{job_id}
  - [ ] Cancel running job
  - [ ] Update status to CANCELLED
  - [ ] Return confirmation
- [ ] 3.5 Statistics endpoint
  - [ ] GET /api/stats
  - [ ] Aggregate job counts by status
  - [ ] Calculate average duration
  - [ ] Return statistics

## Phase 4: WebSocket Implementation
- [ ] 4.1 Status broadcast endpoint
  - [ ] WS /ws/jobs/status
  - [ ] Manage WebSocket connections
  - [ ] Broadcast status updates to all clients
  - [ ] Handle disconnections
- [ ] 4.2 Log streaming endpoint
  - [ ] WS /ws/jobs/{job_id}/logs
  - [ ] Stream logs for specific job
  - [ ] Send historical logs on connect
  - [ ] Stream new logs in real-time
- [ ] 4.3 Connection manager
  - [ ] Track active WebSocket connections
  - [ ] Implement broadcast helper
  - [ ] Handle reconnection

## Phase 5: Frontend Foundation
- [ ] 5.1 Set up React project
  - [ ] Create React app with TypeScript
  - [ ] Install dependencies (react, react-router, axios, etc.)
  - [ ] Set up project structure
  - [ ] Configure proxy to backend
- [ ] 5.2 Create API client
  - [ ] Create axios instance
  - [ ] Implement API methods (submitJob, getJobs, getJobDetail, cancelJob, getStats)
  - [ ] Add error handling
- [ ] 5.3 Create TypeScript types
  - [ ] Define Job type
  - [ ] Define JobMetadata type
  - [ ] Define JobLog type
  - [ ] Define API response types
- [ ] 5.4 Create custom hooks
  - [ ] useWebSocket hook
  - [ ] useJobs hook (fetch jobs)
  - [ ] useJobDetail hook
  - [ ] useJobLogs hook (WebSocket streaming)

## Phase 6: Frontend UI Components
- [ ] 6.1 Create basic layout
  - [ ] App shell with header
  - [ ] Navigation (if needed)
  - [ ] Main content area
- [ ] 6.2 Job submission form
  - [ ] URL input field
  - [ ] Submit button
  - [ ] Validation feedback
  - [ ] Success/error messages
- [ ] 6.3 Job statistics dashboard
  - [ ] Display total jobs
  - [ ] Display jobs by status
  - [ ] Display average duration
- [ ] 6.4 Active jobs panel
  - [ ] List currently running jobs
  - [ ] Show real-time progress
  - [ ] Show current stage
  - [ ] Cancel button
- [ ] 6.5 Job history table
  - [ ] Display job list with columns (ID, title, status, date)
  - [ ] Pagination controls
  - [ ] Status filter dropdown
  - [ ] Click to view details
- [ ] 6.6 Job detail modal/page
  - [ ] Tabs for overview, logs, analysis
  - [ ] Overview: metadata, files
  - [ ] Logs: real-time log viewer
  - [ ] Analysis: summary, insights, topics
  - [ ] Publishing status
- [ ] 6.7 Status badges and progress bars
  - [ ] Color-coded status badges
  - [ ] Progress bar component
  - [ ] Stage indicator

## Phase 7: Real-time Features
- [ ] 7.1 Implement WebSocket connection
  - [ ] Connect to status broadcast endpoint
  - [ ] Listen for status updates
  - [ ] Update job list in real-time
- [ ] 7.2 Implement log streaming
  - [ ] Connect to log stream for active job
  - [ ] Display logs with auto-scroll
  - [ ] Color-code log levels
  - [ ] Format timestamps
- [ ] 7.3 Handle WebSocket reconnection
  - [ ] Detect disconnection
  - [ ] Attempt reconnection
  - [ ] Show connection status indicator

## Phase 8: Testing & Polish
- [ ] 8.1 Backend testing
  - [ ] Test job submission
  - [ ] Test job cancellation
  - [ ] Test concurrent jobs
  - [ ] Test WebSocket connections
  - [ ] Test error handling
- [ ] 8.2 Frontend testing
  - [ ] Test form validation
  - [ ] Test job list rendering
  - [ ] Test real-time updates
  - [ ] Test log streaming
  - [ ] Test responsive design
- [ ] 8.3 Integration testing
  - [ ] Test end-to-end flow
  - [ ] Test with actual YouTube videos
  - [ ] Test multiple concurrent users
- [ ] 8.4 UI/UX polish
  - [ ] Add loading states
  - [ ] Add error states
  - [ ] Add empty states
  - [ ] Improve styling
  - [ ] Add animations/transitions

## Phase 9: Deployment
- [ ] 9.1 Build frontend for production
  - [ ] Run React build
  - [ ] Optimize bundle size
- [ ] 9.2 Configure Nginx
  - [ ] Serve React static files
  - [ ] Proxy API requests
  - [ ] Proxy WebSocket connections
- [ ] 9.3 Set up systemd service
  - [ ] Create service file for FastAPI
  - [ ] Enable and start service
- [ ] 9.4 Database backup setup
  - [ ] Configure PostgreSQL backups
  - [ ] Test restore procedure

## Phase 10: Documentation & Handoff
- [ ] 10.1 Create API documentation
  - [ ] Document all endpoints
  - [ ] Add request/response examples
  - [ ] Generate OpenAPI/Swagger docs
- [ ] 10.2 Create user guide
  - [ ] How to submit jobs
  - [ ] How to view job status
  - [ ] How to cancel jobs
  - [ ] How to view logs
- [ ] 10.3 Create developer documentation
  - [ ] Architecture overview
  - [ ] Database schema
  - [ ] How to add new features
  - [ ] How to deploy updates
- [ ] 10.4 Final summary document
  - [ ] What was built
  - [ ] What changed
  - [ ] Future improvements

---

## Estimated Timeline
- Phase 1-2 (Backend Foundation + Pipeline): 1-2 days
- Phase 3-4 (REST API + WebSocket): 1 day
- Phase 5-6 (Frontend Foundation + UI): 2 days
- Phase 7 (Real-time Features): 1 day
- Phase 8 (Testing & Polish): 1 day
- Phase 9-10 (Deployment & Docs): 0.5 day

**Total: ~6-7 days of development**

---

## Current Status
- [x] Requirements gathered
- [x] Design completed
- [ ] Implementation not started

**Next Step**: Get approval on design, then start Phase 1 implementation.
